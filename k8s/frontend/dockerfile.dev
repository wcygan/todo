# Development Dockerfile for Next.js frontend - Tilt best practices
FROM oven/bun:1-alpine

# Install system dependencies
RUN apk add --no-cache curl bash git

WORKDIR /app

# Copy package files for dependency installation
COPY package.json bun.lock* ./

# Install dependencies
RUN bun install --frozen-lockfile

# Copy source code (will be live-updated by Tilt)
COPY . .

# Create .next directory with proper permissions
RUN mkdir -p .next tmp && \
    chmod -R 777 .next tmp

# Set environment variables optimized for development
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV TURBOPACK=1
ENV HOSTNAME=0.0.0.0
ENV PORT=3000

# Expose port
EXPOSE 3000

# Health check with fallback
HEALTHCHECK --interval=15s --timeout=5s --start-period=20s --retries=3 \
    CMD curl -f http://localhost:3000 || exit 1

# Run Next.js development server
CMD ["bun", "run", "dev", "--turbopack", "--port", "3000", "--hostname", "0.0.0.0"]